# =============================================================================
# Midcurve Finance - Production Environment Variables
# =============================================================================
#
# Copy this file to .env.production and fill in the values.
# All services share this configuration via Docker Compose.
#
# SECURITY: Never commit the actual .env.production file to version control!

# =============================================================================
# Domain Configuration
# =============================================================================
# Update these to match your domain names
APP_URL=https://app.midcurve.finance
API_URL=https://api.midcurve.finance

# =============================================================================
# Frontend (Vite Build Args)
# =============================================================================
# WalletConnect project ID - get from https://cloud.walletconnect.com
VITE_WALLETCONNECT_PROJECT_ID=
# API URL for frontend to call
VITE_API_URL=https://api.midcurve.finance

# =============================================================================
# Database (AWS RDS PostgreSQL)
# =============================================================================
# Format: postgresql://USER:PASSWORD@HOST:5432/DATABASE
# Example: postgresql://midcurve:SecurePass123@midcurve-db.xxxxx.us-east-1.rds.amazonaws.com:5432/midcurve
DATABASE_URL=postgresql://user:password@your-rds-instance.region.rds.amazonaws.com:5432/midcurve

# =============================================================================
# CORS Configuration
# =============================================================================
# Comma-separated list of allowed origins
ALLOWED_ORIGINS=https://app.midcurve.finance

# Cookie domain for cross-subdomain cookies (note the leading dot)
COOKIE_DOMAIN=.midcurve.finance

# =============================================================================
# EVM Chain RPC URLs
# =============================================================================
# Get API keys from Alchemy, Infura, or QuickNode
# IMPORTANT: Use HTTPS endpoints for production

# Ethereum Mainnet (Chain ID: 1)
RPC_URL_ETHEREUM=https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Arbitrum One (Chain ID: 42161)
RPC_URL_ARBITRUM=https://arb-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Base (Chain ID: 8453)
RPC_URL_BASE=https://base-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# BNB Smart Chain (Chain ID: 56)
RPC_URL_BSC=https://bsc-dataseed1.binance.org

# Polygon (Chain ID: 137)
RPC_URL_POLYGON=https://polygon-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Optimism (Chain ID: 10)
RPC_URL_OPTIMISM=https://opt-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# =============================================================================
# WebSocket RPC Endpoints (for pool price subscriptions)
# =============================================================================
# Required for real-time Swap event subscriptions in the pool-prices service.
# Get WebSocket URLs from Alchemy, Infura, or QuickNode.

# Ethereum Mainnet (Chain ID: 1)
WS_RPC_URL_ETHEREUM=wss://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Arbitrum One (Chain ID: 42161)
WS_RPC_URL_ARBITRUM=wss://arb-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Base (Chain ID: 8453)
WS_RPC_URL_BASE=wss://base-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# BNB Smart Chain (Chain ID: 56)
# Note: BSC public nodes typically don't support WebSocket subscriptions
# Leave empty or omit - the pool-prices service handles missing WS endpoints gracefully
WS_RPC_URL_BSC=

# Polygon (Chain ID: 137)
WS_RPC_URL_POLYGON=wss://polygon-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Optimism (Chain ID: 10)
WS_RPC_URL_OPTIMISM=wss://opt-mainnet.g.alchemy.com/v2/YOUR_API_KEY

# Local development (Chain ID: 31337) - only used in non-production
# WS_RPC_URL_LOCAL=ws://localhost:8545

# =============================================================================
# Internal Services Authentication
# =============================================================================
# Shared secrets for service-to-service authentication
# Generate each with: openssl rand -hex 32

# API â†’ Signer service authentication
SIGNER_INTERNAL_API_KEY=

# =============================================================================
# Signer Key Management
# =============================================================================
# Option 1: Local Encrypted Keys (simpler, less secure)
SIGNER_USE_LOCAL_KEYS=true
# Generate with: openssl rand -hex 32
# This key encrypts automation wallet private keys at rest
SIGNER_LOCAL_ENCRYPTION_KEY=

# Option 2: AWS KMS (recommended for production)
# Uncomment and set SIGNER_USE_LOCAL_KEYS=false to use KMS
# AWS_REGION=us-east-1
# AWS_KMS_KEY_ARN=arn:aws:kms:us-east-1:123456789012:key/your-key-id
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=

# =============================================================================
# RabbitMQ Message Broker
# =============================================================================
# RabbitMQ connection settings (internal container)
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=midcurve
# Generate with: openssl rand -base64 16
RABBITMQ_PASS=

# =============================================================================
# External APIs (Optional)
# =============================================================================
# CoinGecko API key for token enrichment
# Get from: https://www.coingecko.com/en/api
COINGECKO_API_KEY=

# Etherscan API key for transaction history
# Get from: https://etherscan.io/apis
ETHERSCAN_API_KEY=

# The Graph API key for subgraph queries
# Get from: https://thegraph.com/studio/
THE_GRAPH_API_KEY=

# Uniswap V3 Subgraph Deployment IDs
# Find IDs at: https://thegraph.com/explorer (search for "uniswap v3")
# Note: These may become outdated - check The Graph Explorer for current deployments
UNISWAP_V3_SUBGRAPH_ID_ETHEREUM=5zvR82QoaXYFyDEKLZ9t6v9adgnptxYpKpSbxtgVENFV
UNISWAP_V3_SUBGRAPH_ID_ARBITRUM=FbCGRftH4a3yZugY7TnbYgPJVEv2LvMT6oF1fxPe9aJM
UNISWAP_V3_SUBGRAPH_ID_BASE=HMuAwufqZ1YCRmzL2SfHTVkzZovC9VL2UAKhjvRqKiR1
UNISWAP_V3_SUBGRAPH_ID_OPTIMISM=AUpZ47RTWDBpco7YTTffGyRkBJ2i26Ms8dQSkUdxPHGc
UNISWAP_V3_SUBGRAPH_ID_POLYGON=3hCPRGf4z88VC5rsBKU5AA9FBBq5nF3jbKJG7VZCbhjm
UNISWAP_V3_SUBGRAPH_ID_BSC=

# =============================================================================
# Pool Prices Service Configuration (Optional)
# =============================================================================
# These have sensible defaults and typically don't need to be changed.

# Maximum pools per WebSocket connection (default: 1000)
# MAX_POOLS_PER_CONNECTION=1000

# WebSocket reconnection settings
# RECONNECT_DELAY_MS=5000
# MAX_RECONNECT_ATTEMPTS=10

# Subscription polling interval in milliseconds (default: 5000)
# POLL_INTERVAL_MS=5000

# Stale subscriber cleanup settings
# CLEANUP_INTERVAL_MS=60000
# STALE_THRESHOLD_MS=60000
# PRUNE_THRESHOLD_MS=86400000

# =============================================================================
# Automation Service Configuration
# =============================================================================
# Price trigger mode determines how price conditions are detected for close orders:
# - polling: Use RPC polling (PriceMonitor) - original behavior, default
# - ohlc: Use OHLC candle consumer (OhlcTriggerConsumer) - event-driven
# - both: Run both systems in parallel (for testing/migration)
PRICE_TRIGGER_MODE=polling

# Price polling interval in milliseconds (default: 10000 = 10 seconds)
# Only used when PRICE_TRIGGER_MODE is "polling" or "both"
PRICE_POLL_INTERVAL_MS=10000

# Contract deployment check interval in milliseconds (default: 5000 = 5 seconds)
DEPLOY_POLL_INTERVAL_MS=5000

# Number of concurrent order execution workers (default: 3)
ORDER_EXECUTOR_POOL_SIZE=3

# Fee configuration for automated order execution
# Address to receive execution fees
EXECUTION_FEE_RECIPIENT=0x0000000000000000000000000000000000000000
# Fee in basis points (50 = 0.5%)
EXECUTION_FEE_BPS=50

# =============================================================================
# Internal Service URLs (Docker Network)
# =============================================================================
# These are pre-configured for Docker Compose deployment.
# Only change if deploying services separately or using different hostnames.

# Signer service URL (called by api, automation)
SIGNER_URL=http://signer:3003

# Automation service URL (called by api)
AUTOMATION_URL=http://automation:3004

# =============================================================================
# Logging Configuration
# =============================================================================
LOG_LEVEL=info
NODE_ENV=production

# =============================================================================
# Local Development Chain (OPTIONAL)
# =============================================================================
# These variables are auto-generated by `pnpm local:setup` in the automation app.
# Only used when NODE_ENV !== 'production' with local Anvil fork (Chain ID: 31337)
#
# Start Anvil fork with: cd apps/midcurve-automation && pnpm local:anvil
# Run setup with: cd apps/midcurve-automation && pnpm local:setup
#
# RPC_URL_LOCAL=http://localhost:8545
# MOCK_USD_ADDRESS=0x...
# MOCK_AUGUSTUS_ADDRESS=0x...
# UNISWAPV3_POSITION_CLOSER_ADDRESS_LOCAL=0x...
# HEDGE_VAULT_FACTORY_ADDRESS_LOCAL=0x...
# MOCK_USD_WETH_POOL_ADDRESS=0x...
