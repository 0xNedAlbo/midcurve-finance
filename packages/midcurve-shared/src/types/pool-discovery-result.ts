/**
 * Pool Discovery Result Types
 *
 * Generic types for pool discovery results across all protocols.
 * Protocol-agnostic design supports Uniswap V3, Orca, Raydium, and future protocols.
 */

import type { Pool } from './pool.js';
import type { PoolConfigMap } from './pool-config.js';

/**
 * Pool discovery result
 *
 * Generic type P constrains to protocol keys from PoolConfigMap.
 * Each protocol can provide different pool naming conventions and metrics.
 *
 * @template P - Protocol identifier ('uniswapv3', etc.)
 *
 * @example
 * ```typescript
 * // Uniswap V3 pool discovery result
 * const result: PoolDiscoveryResult<'uniswapv3'> = {
 *   poolName: "CL10-WETH/USDC",
 *   fee: 500,
 *   protocol: 'uniswapv3',
 *   tvlUSD: "123456789.50",
 *   volumeUSD: "12345678.90",
 *   feesUSD: "1234.56",
 *   pool: uniswapV3Pool
 * };
 * ```
 */
export interface PoolDiscoveryResult<P extends keyof PoolConfigMap> {
  /**
   * Protocol-dependent pool name
   *
   * Format examples:
   * - Uniswap V3: "CL10-WETH/USDC" (CL = Concentrated Liquidity, 10 = tick spacing)
   * - Orca: "WHIRLPOOL-SOL/USDC"
   * - Raydium: "CLMM-SOL/USDC"
   *
   * The format is protocol-specific and generated by the pool discovery service.
   */
  poolName: string;

  /**
   * Fee in basis points (BIPS)
   *
   * Examples:
   * - 100 = 0.01%
   * - 500 = 0.05%
   * - 3000 = 0.3%
   * - 10000 = 1%
   */
  fee: number;

  /**
   * Protocol identifier
   *
   * Matches the protocol field from Pool type.
   * Used for type narrowing and protocol-specific logic.
   */
  protocol: P;

  /**
   * Total Value Locked in USD (from subgraph/indexer)
   *
   * String format to handle large numbers without precision loss.
   * Defaults to "0" if subgraph/indexer unavailable.
   * Service MUST fail if subgraph returns errors (not just unavailable).
   *
   * @example "234567890.75"
   */
  tvlUSD: string;

  /**
   * 24-hour trading volume in USD (from subgraph/indexer)
   *
   * String format to handle large numbers without precision loss.
   * Defaults to "0" if subgraph/indexer unavailable.
   *
   * @example "23456789.12"
   */
  volumeUSD: string;

  /**
   * 24-hour fees collected in USD (from subgraph/indexer)
   *
   * String format to handle large numbers without precision loss.
   * Defaults to "0" if subgraph/indexer unavailable.
   *
   * @example "2345.67"
   */
  feesUSD: string;

  /**
   * 24-hour trading volume for token0 (from subgraph/indexer)
   *
   * Optional field for token-specific volume data.
   * String representation of BigInt in token0's native decimals.
   * Used for accurate APR calculations.
   *
   * @example "1234567890000000000000" // 1,234.567890 tokens with 18 decimals
   */
  volumeToken0?: string;

  /**
   * 24-hour trading volume for token1 (from subgraph/indexer)
   *
   * Optional field for token-specific volume data.
   * String representation of BigInt in token1's native decimals.
   * Used for accurate APR calculations.
   *
   * @example "4567890000000" // 4,567.890 tokens with 6 decimals (USDC)
   */
  volumeToken1?: string;

  /**
   * Price of token0 in token1 terms (from subgraph/indexer)
   *
   * Optional field for token price data.
   * String representation of BigInt (fixed-point decimal).
   * Used for converting token amounts to quote token value.
   *
   * @example For WETH/USDC: "4000000000" (4000 USDC per 1 WETH, 6 decimals)
   */
  token0Price?: string;

  /**
   * Price of token1 in token0 terms (from subgraph/indexer)
   *
   * Optional field for token price data.
   * String representation of BigInt (fixed-point decimal).
   * Used for converting token amounts to quote token value.
   *
   * @example For WETH/USDC: "250000000000000" (0.00025 WETH per 1 USDC, 18 decimals)
   */
  token1Price?: string;

  /**
   * Full pool object with tokens, state, and config
   *
   * Type-safe: For PoolDiscoveryResult<'uniswapv3'>, this is UniswapV3Pool.
   * Contains all pool data including:
   * - token0 and token1 (full Token objects)
   * - Pool configuration (immutable)
   * - Pool state (mutable, current on-chain state)
   */
  pool: Pool<P>;
}

/**
 * Type alias for Uniswap V3 pool discovery result
 *
 * Convenience type for Uniswap V3-specific pool discovery.
 * Ensures pool field is UniswapV3Pool.
 */
export type UniswapV3PoolDiscoveryResult = PoolDiscoveryResult<'uniswapv3'>;

// Future protocol aliases (add as needed):
// export type OrcaPoolDiscoveryResult = PoolDiscoveryResult<'orca'>;
// export type RaydiumPoolDiscoveryResult = PoolDiscoveryResult<'raydium'>;
